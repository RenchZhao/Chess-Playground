<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>对弈中 - Chess Master</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.3.2/pixi.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&family=Noto+Sans+SC:wght@300;400;500;700&family=ZCOOL+KuaiLe&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #F8F6F0;
            --board-dark: #8B4513;
            --board-light: #FFFEF7;
            --accent-gold: #CD7F32;
            --text-dark: #2C2C2C;
            --text-light: #6B5B73;
        }
        
        body {
            background: linear-gradient(135deg, #F8F6F0 0%, #F0EDE5 100%);
            font-family: 'Noto Sans SC', sans-serif;
            min-height: 100vh;
        }
        
        .chess-board {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(8, 1fr);
            width: 480px;
            height: 480px;
            border: 4px solid #8B4513;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .chess-square {
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
        }
        
        .chess-square.light {
            background-color: #FFFEF7;
        }
        
        .chess-square.dark {
            background-color: #8B4513;
        }
        
        .chess-square.selected {
            background-color: #CD7F32 !important;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.3);
        }
        
        .chess-square.highlight {
            background-color: #FFE4B5 !important;
            box-shadow: inset 0 0 15px rgba(205, 127, 50, 0.5);
        }
        
        .chess-square.check {
            background-color: #FF6B6B !important;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .chess-piece {
            font-size: 2.5rem;
            cursor: pointer;
            user-select: none;
            transition: all 0.2s ease;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
        }
        
        .chess-piece:hover {
            transform: scale(1.1);
            filter: drop-shadow(3px 3px 6px rgba(0,0,0,0.4));
        }
        
        .chess-piece.dragging {
            transform: scale(1.2);
            filter: drop-shadow(4px 4px 8px rgba(0,0,0,0.5));
            z-index: 1000;
        }
        
        .game-info {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .move-history {
            max-height: 300px;
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 8px;
            padding: 12px;
        }
        
        .move-item {
            padding: 4px 8px;
            margin: 2px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
        }
        
        .move-item:nth-child(even) {
            background: rgba(205, 127, 50, 0.1);
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-white {
            background: white;
            border: 2px solid #333;
        }
        
        .status-black {
            background: #333;
        }
        
        .control-button {
            background: linear-gradient(135deg, #CD7F32, #B8860B);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(205, 127, 50, 0.3);
        }
        
        .control-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(205, 127, 50, 0.4);
        }
        
        .control-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .game-over-modal {
            backdrop-filter: blur(8px);
            background: rgba(44, 44, 44, 0.5);
        }
        
        .promotion-modal {
            backdrop-filter: blur(8px);
            background: rgba(44, 44, 44, 0.5);
        }
        
        .piece-option {
            background: white;
            border: 2px solid transparent;
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .piece-option:hover {
            border-color: #CD7F32;
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(205, 127, 50, 0.3);
        }
        
        .captured-pieces {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            min-height: 40px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 8px;
        }
        
        .captured-piece {
            font-size: 1.5rem;
            opacity: 0.7;
        }
        
        @media (max-width: 768px) {
            .chess-board {
                width: 320px;
                height: 320px;
            }
            
            .chess-piece {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <nav class="fixed top-0 w-full z-50 bg-white/80 backdrop-blur-md border-b border-gray-200/50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-2">
                    <div class="w-8 h-8 bg-gradient-to-br from-amber-600 to-amber-800 rounded-lg flex items-center justify-center">
                        <span class="text-white font-bold text-sm">♔</span>
                    </div>
                    <span class="text-xl font-bold text-gray-800">Chess Master</span>
                </div>
                <div class="flex items-center space-x-4">
                    <div id="currentPlayer" class="flex items-center">
                        <span class="status-indicator status-white"></span>
                        <span class="text-sm font-medium text-gray-700">白方回合</span>
                    </div>
                    <button onclick="goHome()" class="text-gray-600 hover:text-amber-600 transition-colors">
                        返回主页
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- 游戏主区域 -->
    <div class="pt-16 min-h-screen flex items-center justify-center p-4">
        <div class="max-w-7xl mx-auto grid lg:grid-cols-3 gap-8 items-start">
            <!-- 棋盘区域 -->
            <div class="lg:col-span-2 flex flex-col items-center">
                <div class="mb-6">
                    <div class="text-center mb-4">
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">国际象棋对弈</h2>
                        <div id="gameStatus" class="text-lg text-gray-600">游戏进行中</div>
                    </div>
                </div>
                
                <!-- 棋盘容器 -->
                <div class="relative">
                    <div id="chessBoard" class="chess-board">
                        <!-- 棋盘格子将通过JavaScript生成 -->
                    </div>
                    
                    <!-- 坐标标签 -->
                    <div class="absolute -left-8 top-0 h-full flex flex-col justify-between text-sm font-mono text-gray-600">
                        <span>8</span><span>7</span><span>6</span><span>5</span><span>4</span><span>3</span><span>2</span><span>1</span>
                    </div>
                    <div class="absolute -bottom-6 left-0 w-full flex justify-between text-sm font-mono text-gray-600 px-2">
                        <span>a</span><span>b</span><span>c</span><span>d</span><span>e</span><span>f</span><span>g</span><span>h</span>
                    </div>
                </div>
                
                <!-- 被吃棋子区域 -->
                <div class="mt-6 w-full max-w-md">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <h4 class="text-sm font-semibold text-gray-700 mb-2">白方吃掉</h4>
                            <div id="capturedByWhite" class="captured-pieces">
                                <!-- 被吃的黑方棋子 -->
                            </div>
                        </div>
                        <div>
                            <h4 class="text-sm font-semibold text-gray-700 mb-2">黑方吃掉</h4>
                            <div id="capturedByBlack" class="captured-pieces">
                                <!-- 被吃的白方棋子 -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 游戏信息区域 -->
            <div class="space-y-6">
                <!-- 游戏控制 -->
                <div class="game-info">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">游戏控制</h3>
                    <div class="space-y-3">
                        <button id="newGameBtn" class="control-button w-full">新游戏</button>
                        <button id="undoBtn" class="control-button w-full" disabled>悔棋</button>
                        <button id="drawBtn" class="control-button w-full">提和</button>
                        <button id="resignBtn" class="control-button w-full bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700">认输</button>
                    </div>
                </div>

                <!-- 游戏统计 -->
                <div class="game-info">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">游戏统计</h3>
                    <div class="space-y-3 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-600">对局时长</span>
                            <span id="gameTime" class="font-mono">00:00</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">当前回合</span>
                            <span id="currentTurn">第1回合</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">总步数</span>
                            <span id="totalMoves">0</span>
                        </div>
                    </div>
                </div>

                <!-- 走法历史 -->
                <div class="game-info">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">走法历史</h3>
                    <div id="moveHistory" class="move-history">
                        <div class="text-center text-gray-500 py-4">
                            游戏尚未开始
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 游戏结束弹窗 -->
    <div id="gameOverModal" class="fixed inset-0 z-50 hidden">
        <div class="game-over-modal absolute inset-0" onclick="closeGameOver()"></div>
        <div class="relative z-10 flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-8 transform scale-95 transition-transform duration-300" id="gameOverContent">
                <div class="text-center">
                    <div class="w-20 h-20 mx-auto mb-6 rounded-full flex items-center justify-center" id="gameOverIcon">
                        <!-- 图标将通过JavaScript设置 -->
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-4" id="gameOverTitle">游戏结束</h3>
                    <p class="text-gray-600 mb-8" id="gameOverMessage">对局已结束</p>
                    
                    <div class="space-y-3">
                        <button onclick="newGame()" class="control-button w-full">再来一局</button>
                        <button onclick="goHome()" class="w-full border-2 border-gray-300 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-50 transition-all duration-300">
                            返回主页
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 兵升变弹窗 -->
    <div id="promotionModal" class="fixed inset-0 z-50 hidden">
        <div class="promotion-modal absolute inset-0" onclick="event.stopPropagation()"></div>
        <div class="relative z-10 flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-8 transform scale-95 transition-transform duration-300" id="promotionContent">
                <div class="text-center mb-8">
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">选择升变棋子</h3>
                    <p class="text-gray-600">请选择兵升变后的棋子类型</p>
                </div>
                
                <div id="promotionOptions" class="grid grid-cols-2 gap-4">
                    <!-- 升变选项将通过JavaScript生成 -->
                </div>
            </div>
        </div>
    </div>

    <script src="chess-engine.js"></script>
    <script src="game.js"></script>
</body>
</html>